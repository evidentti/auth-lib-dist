!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("auth-lib",["exports","@angular/core","rxjs","rxjs/operators","@angular/common/http"],t):t((e=e||self)["auth-lib"]={},e.ng.core,e.rxjs,e.rxjs.operators,e.ng.common.http)}(this,(function(e,t,o,n,r){"use strict";var s=function(){function e(){}return e.prototype.ngOnInit=function(){},e.ɵfac=function(t){return new(t||e)},e.ɵcmp=t.ɵɵdefineComponent({type:e,selectors:[["lib-auth-lib"]],decls:2,vars:0,template:function(e,o){1&e&&(t.ɵɵelementStart(0,"p"),t.ɵɵtext(1," auth-lib works! "),t.ɵɵelementEnd())},encapsulation:2}),e}(),i=new t.InjectionToken("Authentication Configuration"),c=function(){function e(){}return e.ɵmod=t.ɵɵdefineNgModule({type:e}),e.ɵinj=t.ɵɵdefineInjector({factory:function(t){return new(t||e)},providers:[{provide:i,useValue:{authenticationUrl:"authenticate",refreshUrl:"refresh",redirectUrl:"redirect"}}],imports:[[]]}),e}();("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(c,{declarations:[s],exports:[s]});var a;!function(e){e.KEYCLOAK="keycloak",e.SIGNICAT="signicat",e.VEPA="vepa",e.CAPTCHA="captcha"}(a||(a={}));var u=function(){function e(e,t){this.httpClient=e,this.config=t,console.log("[AuthService]","constructor",t)}return e.prototype.oauth=function(e){if(console.log("[AuthService]","oauth"),e.state&&e.uri)return this.post(e);throw new Error("Mandatory parameters state or uri missing")},e.prototype.signicat=function(e){if(console.log("[AuthService]","signicat"),e.state&&e.uri){this.authType=a.SIGNICAT;var t={code:e.code,uri:e.uri,state:e.state};return this.post(t)}throw new Error("Mandatory parameters state or uri missing")},e.prototype.vepa=function(e){if(console.log("[AuthService]","vepa"),e.s0&&e.s1&&e.s2&&e.s3&&e.state)return this.authType=a.VEPA,this.post(e);throw new Error("Mandatory parameters s0, s1, s2, s3 or state missing")},e.prototype.keycloak=function(e){if(console.log("[AuthService]","keycloak"),e&&e.state)return e.uri=this.config.redirectUrl,this.authType=a.KEYCLOAK,this.post(e);throw new Error("Mandatory parameters uri or state missing")},e.prototype.captcha=function(e){if(console.log("[AuthService]","captcha"),e.token){this.authType=a.CAPTCHA;var t=e.token;return this.post({token:t})}throw new Error("Mandatory parameters token missing")},e.prototype.refresh=function(e){console.log("[AuthService]","refresh");var t={headers:{Authorization:"Bearer "+e}};return this.httpClient.post(this.config.refreshUrl,null,t).pipe(n.map((function(e){return e&&e.accessToken})))},e.prototype.post=function(e){console.log("[AuthService]","post",e);var t={headers:{"X-Auth-Type":this.authType}};return this.httpClient.post(this.config.authenticationUrl,e,t).pipe(n.map((function(e){return e})))},Object.defineProperty(e.prototype,"authType",{get:function(){return sessionStorage.getItem("auth-type")},set:function(e){sessionStorage.setItem("auth-type",e)},enumerable:!0,configurable:!0}),e.ɵfac=function(o){return new(o||e)(t.ɵɵinject(r.HttpClient),t.ɵɵinject(i))},e.ɵprov=t.ɵɵdefineInjectable({token:e,factory:e.ɵfac,providedIn:"root"}),e}(),h=function(){function e(e){this.authService=e,console.log("[AuthApi]","constructor"),this.type="KEYCLOAK"}return Object.defineProperty(e.prototype,"success",{get:function(){return this.successVariable},set:function(e){e!==this.successVariable&&(this.successVariable=e,this.watchSuccessVariable&&this.watchSuccess.next(this.success))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"watchSuccess",{get:function(){return this.watchSuccessVariable||(this.watchSuccessVariable=new o.BehaviorSubject(this.success)),this.watchSuccessVariable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accessToken",{get:function(){return this.accessTokenVariable||(this.accessTokenVariable=sessionStorage.getItem("accessToken")),this.accessTokenVariable},set:function(e){this.accessTokenVariable=e,this.accessTokenVariable?sessionStorage.setItem("accessToken",this.accessTokenVariable):sessionStorage.removeItem("accessToken")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshToken",{get:function(){return this.refreshTokenVariable||(this.refreshTokenVariable=sessionStorage.getItem("refreshToken")),this.refreshTokenVariable},set:function(e){this.refreshTokenVariable=e,this.refreshTokenVariable?sessionStorage.setItem("refreshToken",this.refreshTokenVariable):sessionStorage.removeItem("refreshToken")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this.typeVariable},set:function(e){this.typeVariable=e},enumerable:!0,configurable:!0}),e.prototype.init=function(e){console.log("[AuthApi]","init");var t=e&&new URLSearchParams(e).get("code");return console.log("[AuthApi]","URL PARAMS",e,"CODE",t),"CAPTCHA"!==this.type&&t?this.codeLogin(t):"CAPTCHA"===this.type?this.captchaLogin():this.initLogin()},e.prototype.initLogin=function(){var e=this;return console.log("[AuthApi]","initLogin"),new o.Observable((function(t){switch(e.type){case"KEYCLOAK":e.authService.keycloak({state:"init"}).subscribe((function(e){console.log("[AuthApi]","keycloak","response",e),e&&e.redirect&&(document.location.href=e.redirect),t.next(Boolean(e&&e.redirect)),t.complete()}));break;default:console.log("[AuthApi]","unknown type"),t.next(null),t.complete()}}))},e.prototype.codeLogin=function(e){var t=this;return console.log("[AuthApi]","codeLogin"),new o.Observable((function(o){switch(t.type){case"KEYCLOAK":var n={state:"init",code:e};t.authService.keycloak(n).subscribe((function(e){console.log("[AuthApi]","keycloak","response",e),t.success=t.handleAccessData(e),o.next(t.success),o.complete()}));break;default:console.log("[AuthApi]","unknown type"),o.next(null),o.complete()}}))},e.prototype.captchaLogin=function(){return console.log("[AuthApi]","captchaLogin"),o.of(null)},e.prototype.getToken=function(){return console.log("[AuthApi]","getToken"),this.accessToken},e.prototype.updateToken=function(){var e=this;return console.log("[AuthApi]","updateToken"),new o.Observable((function(t){e.authService.refresh(e.refreshToken).subscribe((function(o){console.log("[AuthApi]","updateToken","response",o),e.accessToken=o,t.next(o),t.complete()}))}))},e.prototype.handleAccessData=function(e){return console.log("[AuthApi]","handleAccessData",e),e?(this.accessToken=e.accessToken,this.refreshToken=e.refreshToken):(this.accessToken=null,this.refreshToken=null),Boolean(e&&e.accessToken&&e.refreshToken)},e.ɵfac=function(o){return new(o||e)(t.ɵɵinject(u))},e.ɵprov=t.ɵɵdefineInjectable({token:e,factory:e.ɵfac,providedIn:"root"}),e}();e.AuthApi=h,e.AuthComponent=s,e.AuthModule=c,e.DCS_AUTH_CONFIG=i,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=auth-lib.umd.min.js.map