import { Injectable, Inject } from '@angular/core';
import { map } from 'rxjs/operators';
import { DCS_AUTH_CONFIG } from './auth-lib.module';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
const AUTH_TYPE = 'auth-type';
var AuthType;
(function (AuthType) {
    AuthType["KEYCLOAK"] = "keycloak";
    AuthType["SIGNICAT"] = "signicat";
    AuthType["VEPA"] = "vepa";
    AuthType["CAPTCHA"] = "captcha";
})(AuthType || (AuthType = {}));
export class AuthService {
    constructor(httpClient, config) {
        this.httpClient = httpClient;
        this.config = config;
        console.log('[AuthService]', 'constructor', config);
    }
    oauth(params) {
        console.log('[AuthService]', 'oauth');
        if (params.state && params.uri) {
            return this.post(params);
        }
        else {
            throw new Error('Mandatory parameters state or uri missing');
        }
    }
    signicat(params) {
        console.log('[AuthService]', 'signicat');
        if (params.state && params.uri) {
            this.authType = AuthType.SIGNICAT;
            const body = { code: params.code, uri: params.uri, state: params.state };
            return this.post(body);
        }
        else {
            throw new Error('Mandatory parameters state or uri missing');
        }
    }
    vepa(params) {
        console.log('[AuthService]', 'vepa');
        if (params.s0 && params.s1 && params.s2 && params.s3 && params.state) {
            this.authType = AuthType.VEPA;
            return this.post(params);
        }
        else {
            throw new Error('Mandatory parameters s0, s1, s2, s3 or state missing');
        }
    }
    keycloak(params) {
        console.log('[AuthService]', 'keycloak');
        if (params && params.state) {
            params.uri = this.config.redirectUrl;
            this.authType = AuthType.KEYCLOAK;
            return this.post(params);
        }
        else {
            throw new Error('Mandatory parameters uri or state missing');
        }
    }
    captcha(params) {
        console.log('[AuthService]', 'captcha');
        if (params.token) {
            this.authType = AuthType.CAPTCHA;
            const token = params.token;
            return this.post({ token });
        }
        else {
            throw new Error('Mandatory parameters token missing');
        }
    }
    refresh(token) {
        console.log('[AuthService]', 'refresh');
        const options = { headers: { Authorization: `Bearer ${token}` } };
        return this.httpClient.post(this.config.refreshUrl, null, options).pipe(map((response) => {
            return response && response.accessToken;
        }));
    }
    post(body) {
        console.log('[AuthService]', 'post', body);
        const options = { headers: { 'X-Auth-Type': this.authType } };
        return this.httpClient.post(this.config.authenticationUrl, body, options).pipe(map((response) => {
            return response;
        }));
    }
    get authType() {
        return sessionStorage.getItem(AUTH_TYPE);
    }
    set authType(type) {
        sessionStorage.setItem(AUTH_TYPE, type);
    }
}
AuthService.ɵfac = function AuthService_Factory(t) { return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(DCS_AUTH_CONFIG)); };
AuthService.ɵprov = i0.ɵɵdefineInjectable({ token: AuthService, factory: AuthService.ɵfac, providedIn: 'root' });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(AuthService, [{
        type: Injectable,
        args: [{
                providedIn: 'root',
            }]
    }], function () { return [{ type: i1.HttpClient }, { type: undefined, decorators: [{
                type: Inject,
                args: [DCS_AUTH_CONFIG]
            }] }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYXV0aC1saWIvIiwic291cmNlcyI6WyJsaWIvYXV0aC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBR25ELE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUUsZUFBZSxFQUFjLE1BQU0sbUJBQW1CLENBQUM7OztBQUVoRSxNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUM7QUFFOUIsSUFBSyxRQUtKO0FBTEQsV0FBSyxRQUFRO0lBQ1gsaUNBQXFCLENBQUE7SUFDckIsaUNBQXFCLENBQUE7SUFDckIseUJBQWEsQ0FBQTtJQUNiLCtCQUFtQixDQUFBO0FBQ3JCLENBQUMsRUFMSSxRQUFRLEtBQVIsUUFBUSxRQUtaO0FBV0QsTUFBTSxPQUFPLFdBQVc7SUFFdEIsWUFBc0IsVUFBc0IsRUFBbUMsTUFBa0I7UUFBM0UsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUFtQyxXQUFNLEdBQU4sTUFBTSxDQUFZO1FBQy9GLE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxFQUFFLGFBQWEsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRU0sS0FBSyxDQUFDLE1BQVc7UUFDdEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDdEMsSUFBSSxNQUFNLENBQUMsS0FBSyxJQUFJLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDOUIsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQzFCO2FBQU07WUFDTCxNQUFNLElBQUksS0FBSyxDQUFDLDJDQUEyQyxDQUFDLENBQUM7U0FDOUQ7SUFDSCxDQUFDO0lBRU0sUUFBUSxDQUFDLE1BQVc7UUFDekIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLEVBQUUsVUFB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RUFBRSxPQUFPLEVBQUUsRUFBRSxhQUFhLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUM7UUFDOUQsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBYSxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixFQUFFLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQ3hGLEdBQUcsQ0FBQyxDQUFDLFFBQW9CLEVBQUUsRUFBRTtZQUMzQixPQUFPLFFBQVEsQ0FBQztRQUNsQixDQUFDLENBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUVELElBQUksUUFBUTtRQUNWLE9BQU8sY0FBYyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQWEsQ0FBQztJQUN2RCxDQUFDO0lBRUQsSUFBSSxRQUFRLENBQUMsSUFBYztRQUN6QixjQUFjLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUMxQyxDQUFDOztzRUFwRlUsV0FBVywwQ0FFZ0MsZUFBZTttREFGMUQsV0FBVyxXQUFYLFdBQVcsbUJBRlYsTUFBTTtrREFFUCxXQUFXO2NBSHZCLFVBQVU7ZUFBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQjs7c0JBR2dELE1BQU07dUJBQUMsZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IERDU19BVVRIX0NPTkZJRywgQXV0aENvbmZpZyB9IGZyb20gJy4vYXV0aC1saWIubW9kdWxlJztcblxuY29uc3QgQVVUSF9UWVBFID0gJ2F1dGgtdHlwZSc7XG5cbmVudW0gQXV0aFR5cGUge1xuICBLRVlDTE9BSyA9ICdrZXljbG9haycsXG4gIFNJR05JQ0FUID0gJ3NpZ25pY2F0JyxcbiAgVkVQQSA9ICd2ZXBhJyxcbiAgQ0FQVENIQSA9ICdjYXB0Y2hhJ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFjY2Vzc0RhdGEge1xuICBhY2Nlc3NUb2tlbj86IHN0cmluZztcbiAgcmVmcmVzaFRva2VuPzogc3RyaW5nO1xuICByZWRpcmVjdD86IHN0cmluZztcbn1cblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCcsXG59KVxuZXhwb3J0IGNsYXNzIEF1dGhTZXJ2aWNlIHtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaHR0cENsaWVudDogSHR0cENsaWVudCwgQEluamVjdChEQ1NfQVVUSF9DT05GSUcpIHByaXZhdGUgY29uZmlnOiBBdXRoQ29uZmlnKSB7XG4gICAgY29uc29sZS5sb2coJ1tBdXRoU2VydmljZV0nLCAnY29uc3RydWN0b3InLCBjb25maWcpO1xuICB9XG5cbiAgcHVibGljIG9hdXRoKHBhcmFtczogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ1tBdXRoU2VydmljZV0nLCAnb2F1dGgnKTtcbiAgICBpZiAocGFyYW1zLnN0YXRlICYmIHBhcmFtcy51cmkpIHtcbiAgICAgIHJldHVybiB0aGlzLnBvc3QocGFyYW1zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdNYW5kYXRvcnkgcGFyYW1ldGVycyBzdGF0ZSBvciB1cmkgbWlzc2luZycpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzaWduaWNhdChwYXJhbXM6IGFueSk6IE9ic2VydmFibGU8QWNjZXNzRGF0YT4ge1xuICAgIGNvbnNvbGUubG9nKCdbQXV0aFNlcnZpY2VdJywgJ3NpZ25pY2F0Jyk7XG4gICAgaWYgKHBhcmFtcy5zdGF0ZSAmJiBwYXJhbXMudXJpKSB7XG4gICAgICB0aGlzLmF1dGhUeXBlID0gQXV0aFR5cGUuU0lHTklDQVQ7XG4gICAgICBjb25zdCBib2R5ID0geyBjb2RlOiBwYXJhbXMuY29kZSwgdXJpOiBwYXJhbXMudXJpLCBzdGF0ZTogcGFyYW1zLnN0YXRlIH07XG4gICAgICByZXR1cm4gdGhpcy5wb3N0KGJvZHkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ01hbmRhdG9yeSBwYXJhbWV0ZXJzIHN0YXRlIG9yIHVyaSBtaXNzaW5nJyk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHZlcGEocGFyYW1zOiBhbnkpOiBPYnNlcnZhYmxlPEFjY2Vzc0RhdGE+IHtcbiAgICBjb25zb2xlLmxvZygnW0F1dGhTZXJ2aWNlXScsICd2ZXBhJyk7XG4gICAgaWYgKHBhcmFtcy5zMCAmJiBwYXJhbXMuczEgJiYgcGFyYW1zLnMyICYmIHBhcmFtcy5zMyAmJiBwYXJhbXMuc3RhdGUpIHtcbiAgICAgIHRoaXMuYXV0aFR5cGUgPSBBdXRoVHlwZS5WRVBBO1xuICAgICAgcmV0dXJuIHRoaXMucG9zdChwYXJhbXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ01hbmRhdG9yeSBwYXJhbWV0ZXJzIHMwLCBzMSwgczIsIHMzIG9yIHN0YXRlIG1pc3NpbmcnKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMga2V5Y2xvYWsocGFyYW1zOiBhbnkpOiBPYnNlcnZhYmxlPEFjY2Vzc0RhdGE+IHtcbiAgICBjb25zb2xlLmxvZygnW0F1dGhTZXJ2aWNlXScsICdrZXljbG9haycpO1xuICAgIGlmIChwYXJhbXMgJiYgcGFyYW1zLnN0YXRlKSB7XG4gICAgICBwYXJhbXMudXJpID0gdGhpcy5jb25maWcucmVkaXJlY3RVcmw7XG4gICAgICB0aGlzLmF1dGhUeXBlID0gQXV0aFR5cGUuS0VZQ0xPQUs7XG4gICAgICByZXR1cm4gdGhpcy5wb3N0KHBhcmFtcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTWFuZGF0b3J5IHBhcmFtZXRlcnMgdXJpIG9yIHN0YXRlIG1pc3NpbmcnKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgY2FwdGNoYShwYXJhbXM6IGFueSk6IE9ic2VydmFibGU8QWNjZXNzRGF0YT4ge1xuICAgIGNvbnNvbGUubG9nKCdbQXV0aFNlcnZpY2VdJywgJ2NhcHRjaGEnKTtcbiAgICBpZiAocGFyYW1zLnRva2VuKSB7XG4gICAgICB0aGlzLmF1dGhUeXBlID0gQXV0aFR5cGUuQ0FQVENIQTtcbiAgICAgIGNvbnN0IHRva2VuID0gcGFyYW1zLnRva2VuO1xuICAgICAgcmV0dXJuIHRoaXMucG9zdCh7IHRva2VuIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ01hbmRhdG9yeSBwYXJhbWV0ZXJzIHRva2VuIG1pc3NpbmcnKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgcmVmcmVzaCh0b2tlbjogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICBjb25zb2xlLmxvZygnW0F1dGhTZXJ2aWNlXScsICdyZWZyZXNoJyk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHsgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9IH07XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0PEFjY2Vzc0RhdGE+KHRoaXMuY29uZmlnLnJlZnJlc2hVcmwsIG51bGwsIG9wdGlvbnMpLnBpcGUoXG4gICAgICBtYXAoKHJlc3BvbnNlOiBBY2Nlc3NEYXRhKSA9PiB7XG4gICAgICAgIHJldHVybiByZXNwb25zZSAmJiByZXNwb25zZS5hY2Nlc3NUb2tlbjtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgcG9zdChib2R5OiBhbnkpOiBPYnNlcnZhYmxlPEFjY2Vzc0RhdGE+IHtcbiAgICBjb25zb2xlLmxvZygnW0F1dGhTZXJ2aWNlXScsICdwb3N0JywgYm9keSk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHsgaGVhZGVyczogeyAnWC1BdXRoLVR5cGUnOiB0aGlzLmF1dGhUeXBlIH0gfTtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3Q8QWNjZXNzRGF0YT4odGhpcy5jb25maWcuYXV0aGVudGljYXRpb25VcmwsIGJvZHksIG9wdGlvbnMpLnBpcGUoXG4gICAgICBtYXAoKHJlc3BvbnNlOiBBY2Nlc3NEYXRhKSA9PiB7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIGdldCBhdXRoVHlwZSgpIHtcbiAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShBVVRIX1RZUEUpIGFzIEF1dGhUeXBlO1xuICB9XG5cbiAgc2V0IGF1dGhUeXBlKHR5cGU6IEF1dGhUeXBlKSB7XG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShBVVRIX1RZUEUsIHR5cGUpO1xuICB9XG59XG4iXX0=